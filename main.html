<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Speedo - Home</title>
    
    <!-- Added Noto Sans Sinhala and Tamil for better local language rendering -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Mona+Sans:wght@300;400;600;700&family=Poppins:wght@300;400;500;600;700&family=Noto+Sans+Sinhala:wght@400;500;600;700&family=Noto+Sans+Tamil:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <style>
        :root {
            --primary-red: #D32F2F;
            --primary-dark: #b71c1c;
            --white: #ffffff;
            --gray-light: #f5f5f5;
            --gray-text: #757575;
            --text-main: #333333;
            --border-radius-card: 24px;
            --border-radius-pill: 50px;
            /* Update font stack to support SI/TA */
            --font-main: 'Poppins', 'Noto Sans Sinhala', 'Noto Sans Tamil', sans-serif;
            --font-alt: 'Inter', 'Noto Sans Sinhala', 'Noto Sans Tamil', sans-serif;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; outline: none; }

        /* HIDE SCROLLBARS */
        html, body { scrollbar-width: none; -ms-overflow-style: none; }
        *::-webkit-scrollbar { display: none; }

        body {
            font-family: var(--font-main);
            background-color: var(--gray-light);
            height: 100vh; width: 100vw;
            display: flex; justify-content: center; align-items: center;
            overflow: hidden; color: var(--text-main);
        }

        #app {
            width: 100%; height: 100%; max-width: 480px;
            background-color: var(--white); position: relative;
            overflow: hidden; display: flex; flex-direction: column;
        }

        .content-area {
            flex: 1; overflow-y: auto;
            padding-bottom: 90px;
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .content-area.active { 
            display: block; 
            opacity: 1; 
        }

        header {
            padding: 20px 24px 10px 24px;
            background: white; position: sticky; top: 0; z-index: 10;
            display: flex; justify-content: space-between; align-items: flex-start;
        }

        .header-left { flex: 1; }

        /* Language Button */
        .lang-btn {
            background: #f0f0f0;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            z-index: 20;
            font-weight: 700;
            font-size: 14px;
            color: var(--primary-red);
        }
        .lang-btn:active { background: #e0e0e0; }

        h1.page-title {
            font-size: 32px;
            font-weight: 800;
            color: var(--text-main);
            margin-bottom: 10px;
            padding-left: 20px;
            padding-top: 25px;
            line-height: 1.2;
        }
        h1.section-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-main);
            margin: 20px 20px 10px 20px;
        }

        /* HOME COMPONENTS */
        .greeting { font-size: 14px; color: var(--gray-text); font-family: var(--font-alt); margin-top: 4px;}
        
        .search-container { padding: 10px 20px; background: white; }
        .search-pill {
            background: var(--gray-light); border-radius: var(--border-radius-pill);
            display: flex; align-items: center; padding: 5px 5px 5px 20px;
            transition: background 0.2s;
        }
        .search-pill:focus-within { background: #eeeeee; }
        .search-pill input { flex: 1; background: transparent; border: none; font-size: 15px; color: var(--text-main); font-family: var(--font-alt); }
        .search-arrow {
            background: var(--primary-red); color: white; width: 45px; height: 45px;
            border-radius: 50%; display: flex; justify-content: center; align-items: center;
            cursor: pointer; transition: transform 0.1s;
        }
        .search-arrow:active { transform: scale(0.9); }

        .ad-section-top { padding: 10px 20px; }
        .ad-carousel-wrapper { position: relative; width: 100%; aspect-ratio: 32 / 9; border-radius: 16px; overflow: hidden; background: #ddd; }
        .ad-slide { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; transition: opacity 0.5s; display: flex; justify-content: center; align-items: center; }
        .ad-slide.active { opacity: 1; }
        .ad-slide img { width: 100%; height: 100%; object-fit: cover; }
        .ad-badge { position: absolute; top: 8px; left: 8px; background: rgba(0,0,0,0.6); color: white; font-size: 10px; padding: 2px 6px; border-radius: 4px; text-transform: uppercase; font-weight: 600; }

        .ongoing-section { padding: 20px; display: flex; flex-direction: column; gap: 15px; }
        .ongoing-card {
            background: var(--primary-red); border-radius: 20px; padding: 20px;
            color: white; display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 4px 15px rgba(211, 47, 47, 0.3);
        }
        .ongoing-info h3 { font-size: 18px; margin-bottom: 5px; }
        .ongoing-info p { font-size: 13px; opacity: 0.9; font-family: var(--font-alt); }
        .ongoing-icon { font-size: 32px; opacity: 0.8; }

        .quick-actions { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; padding: 10px 20px; }
        .action-btn {
            background: white; border-radius: 16px; overflow: hidden;
            cursor: pointer; text-decoration: none; color: inherit;
            display: flex; flex-direction: column; height: 110px; position: relative;
            transition: transform 0.1s; box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .action-btn:active { transform: scale(0.97); }
        .action-btn img { width: 100%; height: 100%; object-fit: cover; }
        .action-label {
            position: absolute; bottom: 0; left: 0; width: 100%;
            background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
            color: white; padding: 8px; font-size: 12px; font-weight: 600; text-align: center;
        }

        .info-cards { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 10px 20px; flex: 1; }
        .info-card {
            border-radius: 20px; padding: 15px; display: flex; flex-direction: column;
            cursor: pointer; min-height: 140px; position: relative;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); text-decoration: none; color: inherit;
        }
        .weather-card { background: white; text-align: left; }
        .help-card { background: var(--primary-red); color: white; border: none; box-shadow: 0 4px 15px rgba(211, 47, 47, 0.3); align-items: center; text-align: center; justify-content: center; }
        .weather-temp { font-size: 24px; font-weight: 700; margin: 5px 0; color: var(--text-main); }
        .weather-district { font-size: 12px; color: var(--gray-text); }
        .help-icon { font-size: 32px; color: white; margin-bottom: 5px; }
        .help-text { font-weight: 600; font-size: 14px; line-height: 1.4; }

        .ad-section-bottom { padding: 20px; margin-top: auto; }
        .ad-banner-16-5 { width: 100%; aspect-ratio: 16 / 5; border-radius: 16px; overflow: hidden; background: #eee; position: relative; }
        .ad-banner-16-5 img { width: 100%; height: 100%; object-fit: cover; }

        /* PROMOTIONS PAGE */
        .promotions-grid { padding: 20px; display: flex; flex-direction: column; gap: 20px; }
        .promo-card {
            width: 100%;
            aspect-ratio: 16 / 10;
            background: white;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            overflow: hidden;
            cursor: pointer;
            position: relative;
        }
        .promo-img-container {
            width: 100%;
            aspect-ratio: 16 / 7;
            background: #eee;
            overflow: hidden;
        }
        .promo-img-container img { width: 100%; height: 100%; object-fit: cover; }
        .promo-details { padding: 15px; }
        .promo-title { font-size: 16px; font-weight: 700; margin-bottom: 5px; color: var(--text-main); }
        
        .promo-link-hint {
            font-size: 11px;
            color: #999;
            font-style: italic;
            margin-top: 5px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .activity-box { text-align: center; padding: 20px; color: var(--gray-text); font-size: 14px; }

        /* PROFILE PAGE */
        .profile-section { padding: 20px; position: relative; }
        .profile-name {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-main);
            margin-bottom: 5px;
            line-height: 1.3;
            word-wrap: break-word;
        }
        .profile-uid {
            font-size: 12px;
            color: var(--gray-text);
            margin-bottom: 20px;
            font-family: monospace;
        }
        .settings-btn {
            width: 100%;
            padding: 15px;
            background: #f0f0f0;
            border: none;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            color: var(--text-main);
            font-size: 16px;
            font-weight: 600;
            position: relative;
            font-family: var(--font-main);
        }
        .sign-out-btn {
            margin-top: 15px;
            background: #ffebee;
            color: var(--primary-red);
        }
        .sign-out-btn:active { background: #ffcdd2; }

        /* DROPDOWN MENU */
        .dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            background: white;
            border-radius: 16px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            overflow: hidden;
            z-index: 100;
            margin-top: 5px;
            display: none;
            animation: slideDown 0.2s ease-out;
        }
        .dropdown-menu.open { display: block; }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .dropdown-item {
            width: 100%;
            padding: 15px;
            background: transparent;
            border: none;
            text-align: left;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            color: var(--text-main);
            font-family: var(--font-main);
        }
        .dropdown-item:active { background: #f0f0f0; }
        .dropdown-item.danger { color: var(--primary-red); }
        .dropdown-divider { height: 1px; background: #eee; }

        /* BOTTOM NAV */
        .bottom-nav {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 95%; max-width: 456px; background: white; height: 70px;
            border-radius: 35px; display: flex; justify-content: space-around; align-items: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1); z-index: 100;
        }
        .nav-item { width: 45px; height: 45px; display: flex; justify-content: center; align-items: center; cursor: pointer; position: relative; }
        .nav-icon { color: #bdbdbd; font-size: 26px; transition: color 0.3s; }
        .nav-item.active .nav-icon { color: var(--primary-red); }
        .nav-item.active::after { content: ''; position: absolute; bottom: 0; width: 6px; height: 6px; background: var(--primary-red); border-radius: 50%; }

        /* MODALS & TOASTS */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 1000;
            display: none; justify-content: center; align-items: center;
        }
        .modal-card {
            background: white; width: 85%; max-width: 350px;
            border-radius: 20px; padding: 25px; text-align: center;
            animation: popIn 0.2s ease;
        }
        
        /* Link Popup Specifics */
        .link-modal-window {
            background: white;
            width: 95%;
            height: 90%;
            position: relative;
            display: flex;
            flex-direction: column;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .link-modal-header {
            height: 50px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 15px;
            background: #fff;
        }
        .link-modal-content {
            flex: 1;
            width: 100%;
            background: #f5f5f5;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .link-iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        .btn-open-browser {
            background: var(--primary-red);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            text-decoration: none;
            font-size: 12px;
            font-weight: 600;
        }
        .close-icon {
            cursor: pointer;
            color: var(--text-main);
            padding: 5px;
        }

        .modal-title { font-size: 18px; font-weight: 700; margin-bottom: 10px; }
        .modal-text { font-size: 14px; color: var(--gray-text); margin-bottom: 20px; }
        .modal-actions { display: flex; flex-direction: column; gap: 10px; }
        .btn-modal {
            padding: 12px; border-radius: 12px; border: none;
            font-weight: 600; cursor: pointer; font-size: 14px;
            font-family: var(--font-main);
        }
        .btn-confirm { background: var(--primary-red); color: white; }
        .btn-cancel { background: #f0f0f0; color: var(--text-main); }

        .toast {
            position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%);
            background: rgba(30,30,30,0.9); color: white;
            padding: 12px 24px; border-radius: 50px; font-size: 14px;
            z-index: 2000; pointer-events: none; opacity: 0;
            transition: opacity 0.3s;
        }
        .toast.show { opacity: 1; }

        .skeleton { background: #e0e0e0; border-radius: 8px; position: relative; overflow: hidden; }
        .skeleton::after { content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent); transform: translateX(-100%); animation: shimmer 1.5s infinite; }
        @keyframes shimmer { 100% { transform: translateX(100%); } }
        @keyframes popIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="app">
        <!-- SKELETON -->
        <div id="skeleton-view" style="padding: 20px; width: 100%; position: absolute; z-index: 50; background: white; height: 100%;">
            <div class="skeleton" style="height: 30px; width: 40%; margin-bottom: 10px;"></div>
            <div class="skeleton" style="height: 20px; width: 80%; margin-bottom: 20px;"></div>
            <div class="skeleton" style="height: 60px; width: 100%; border-radius: 50px; margin-bottom: 20px;"></div>
            <div class="skeleton" style="height: 100px; width: 100%; border-radius: 16px; margin-bottom: 20px;"></div>
        </div>

        <!-- HOME PAGE -->
        <div id="page-home" class="content-area">
            <header>
                <div class="header-left">
                    <h1 id="user-greeting-name">Hello, User</h1>
                    <p class="greeting" id="random-greeting-text" data-i18n="greeting_sub1">It's a beautiful day...</p>
                </div>
                <!-- Language Toggle Button -->
                <button class="lang-btn" id="lang-toggle-btn" onclick="toggleLanguage()">
                    EN
                </button>
            </header>

            <div class="search-container">
                <div class="search-pill">
                    <input type="text" id="destination-input" data-i18n-placeholder="search_ph" placeholder="Where do you want to ride?">
                    <div class="search-arrow" onclick="handleSearch()"><span class="material-icons">arrow_forward</span></div>
                </div>
            </div>

            <div class="ad-section-top">
                <div class="ad-carousel-wrapper" id="ad-carousel-top"><div class="ad-badge">Ad</div></div>
            </div>

            <div class="ongoing-section">
                <h3 style="font-size: 16px; color: var(--text-main);" data-i18n="ongoing">Ongoing Activities</h3>
                <div class="ongoing-card">
                    <div class="ongoing-info">
                        <h3 data-i18n="no_ongoing">No Ongoing Activities</h3>
                        <p data-i18n="start_new">Start a new ride or delivery</p>
                    </div>
                    <span class="material-icons ongoing-icon">history</span>
                </div>
            </div>

            <div class="quick-actions">
                <a href="ride.html" class="action-btn"><img src="https://i.ibb.co/YTD2wbVZ/car-final-2.jpg" alt="Ride"><div class="action-label" data-i18n="ride">Ride</div></a>
                <a href="flash.html" class="action-btn"><img src="https://i.ibb.co/kgvZRZ5W/delivery-guy.png" alt="Flash"><div class="action-label" data-i18n="flash">Flash</div></a>
                <a href="food.html" class="action-btn"><img src="https://i.ibb.co/H3PgK7H/bag-final-1-1.jpg" alt="Food"><div class="action-label" data-i18n="food">Food</div></a>
            </div>

            <div class="info-cards">
                <div class="info-card weather-card">
                    <span id="weather-emoji" style="font-size: 24px;">‚õÖ</span>
                    <div class="weather-temp" id="weather-temp">--¬∞C</div>
                    <div class="weather-district" id="weather-district">Locating...</div>
                </div>
                <a href="help.html" class="info-card help-card">
                    <span class="material-icons help-icon">support_agent</span>
                    <div class="help-text" data-i18n="help_emergency">Help &<br>Emergency</div>
                </a>
            </div>

            <div class="ad-section-bottom">
                <div class="ad-banner-16-5" id="ad-banner-bottom"></div>
            </div>
        </div>

        <!-- ACTIVITIES PAGE -->
        <div id="page-activities" class="content-area">
            <h1 class="page-title" data-i18n="activities">Activities</h1>
            <!-- Content not specified -->
        </div>

        <!-- PROMOTIONS PAGE -->
        <div id="page-promotions" class="content-area">
            <h1 class="page-title" data-i18n="promotions">Promotions</h1>
            <div class="promotions-grid" id="promotions-container">
                <div class="activity-box" data-i18n="loading_promo">Loading promotions...</div>
            </div>
        </div>

        <!-- PROFILE PAGE -->
        <div id="page-profile" class="content-area">
            <h1 class="page-title" data-i18n="profile">Profile</h1>
            <div class="profile-section">
                <div class="profile-name" id="profile-name">Loading...</div>
                <div class="profile-uid" id="profile-uid">ID: --</div>
                
                <!-- SIGN OUT BUTTON WITH DROPDOWN -->
                <div style="position: relative;">
                    <button class="settings-btn sign-out-btn" onclick="toggleSignOutMenu(event)">
                        <span data-i18n="sign_out">Sign Out</span>
                        <span class="material-icons">expand_more</span>
                    </button>
                    <div id="signout-dropdown" class="dropdown-menu">
                        <button class="dropdown-item" onclick="handleSignOut()" data-i18n="sign_out">Sign Out</button>
                        <div class="dropdown-divider"></div>
                        <button class="dropdown-item danger" onclick="showDeleteConfirm()" data-i18n="delete_signout">Delete and Sign Out</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- BOTTOM NAV -->
        <nav class="bottom-nav">
            <div class="nav-item active" onclick="switchPage('home')"><span class="material-icons nav-icon">home</span></div>
            <div class="nav-item" onclick="switchPage('activities')"><span class="material-icons nav-icon">history</span></div>
            <div class="nav-item" onclick="switchPage('promotions')"><span class="material-icons nav-icon">local_offer</span></div>
            <div class="nav-item" onclick="switchPage('profile')"><span class="material-icons nav-icon">person</span></div>
        </nav>
    </div>

    <!-- TOAST -->
    <div id="toast" class="toast">Message</div>

    <!-- DELETE CONFIRM MODAL -->
    <div id="delete-modal" class="modal-overlay">
        <div class="modal-card">
            <div class="modal-title" style="color:red;" data-i18n="delete_account">Delete Account?</div>
            <div class="modal-text" data-i18n="delete_warning">This will permanently delete your account and data. This action cannot be undone.</div>
            <div class="modal-actions">
                <button class="btn-modal btn-confirm" onclick="handleDeleteAccount()" data-i18n="confirm_delete">Confirm Delete</button>
            </div>
            <button class="btn-modal btn-cancel" style="margin-top:10px;" onclick="closeDeleteModal()" data-i18n="cancel">Cancel</button>
        </div>
    </div>

    <!-- LINK POPUP MODAL -->
    <div id="link-modal" class="modal-overlay">
        <div class="link-modal-window">
            <div class="link-modal-header">
                <span style="font-size:14px; font-weight:600;" data-i18n="promo_link">Promotion Link</span>
                <div style="display:flex; gap:10px; align-items:center;">
                    <a id="external-link-btn" href="#" target="_blank" class="btn-open-browser" style="display:none;" data-i18n="open_browser">Open in Browser</a>
                    <span class="material-icons close-icon" onclick="closeLinkModal()">close</span>
                </div>
            </div>
            <div class="link-modal-content">
                <iframe id="promo-iframe" class="link-iframe" sandbox="allow-scripts allow-same-origin allow-forms"></iframe>
                <div id="iframe-fallback" style="display:none; text-align:center; padding:20px; color:#666;">
                    <p data-i18n="cant_display">This site cannot be displayed inside app.</p>
                    <a id="fallback-link-btn" href="#" target="_blank" class="btn-open-browser" style="margin-top:10px;" data-i18n="open_external">Open Link Externally</a>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getDatabase, ref, get, remove } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC3Rf4x5a_L1cYVa6soADfYktQK5WyMN-4",
            authDomain: "speedo-acb7c.firebaseapp.com",
            databaseURL: "https://speedo-acb7c-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "speedo-acb7c",
            storageBucket: "speedo-acb7c.firebasestorage.app",
            messagingSenderId: "31066493782",
            appId: "1:31066493782:web:e3e9dfa209fa855bc17cf7",
            measurementId: "G-ND3GRGL0WQ"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        let currentUser = null;
        let currentLang = localStorage.getItem('speedo_lang') || 'en';
        let firstName = "";

        /* --- NATURAL TRANSLATIONS (EN / SI / TA) --- */
        const translations = {
            en: {
                greeting_hello: "Hello, ",
                greeting_sub1: "It's a beautiful day to get out and go somewhere!",
                greeting_sub2: "Ready for your next adventure?",
                greeting_sub3: "Where to today?",
                search_ph: "Where do you want to ride?",
                ongoing: "Ongoing Activities",
                no_ongoing: "No Ongoing Activities",
                start_new: "Start a new ride or delivery",
                ride: "Ride",
                flash: "Flash",
                food: "Food",
                help_emergency: "Help &<br>Emergency",
                activities: "Activities",
                promotions: "Promotions",
                profile: "Profile",
                sign_out: "Sign Out",
                delete_signout: "Delete and Sign Out",
                delete_account: "Delete Account?",
                delete_warning: "This will permanently delete your account and data. This action cannot be undone.",
                confirm_delete: "Confirm Delete",
                cancel: "Cancel",
                promo_link: "Promotion Link",
                open_browser: "Open in Browser",
                cant_display: "This site cannot be displayed inside app.",
                open_external: "Open Link Externally",
                loading_promo: "Loading promotions...",
                no_promos: "No active promotions",
                promo_link_hint: "Tap to open link"
            },
            si: {
                greeting_hello: "‡∂Ü‡∂∫‡∑î‡∂∂‡∑ù‡∑Ä‡∂±‡∑ä, ",
                greeting_sub1: "‡∂ú‡∂∏‡∂±‡∂ö‡∑ä ‡∂∫‡∂±‡∑ä‡∂± ‡∑Ñ‡∑ú‡∂≥‡∂∏ ‡∑Ä‡∑ô‡∂Ω‡∑è‡∑Ä‡∂ö‡∑ä!",
                greeting_sub2: "‡∂Ö‡∂Ω‡∑î‡∂≠‡∑ä ‡∂ú‡∂∏‡∂±‡∂ö‡∂ß ‡∂î‡∂∂ ‡∑É‡∑ñ‡∂Ø‡∑è‡∂±‡∂∏‡∑ä‡∂Ø?",
                greeting_sub3: "‡∂Ö‡∂Ø ‡∂Ö‡∂¥‡∑í ‡∂∫‡∂±‡∑ä‡∂±‡∑ö ‡∂ö‡∑ú‡∑Ñ‡∑ô‡∂Ø?",
                search_ph: "‡∂î‡∂∂ ‡∂∫‡∂±‡∑ä‡∂± ‡∂∂‡∂Ω‡∑è‡∂¥‡∑ú‡∂ª‡∑ú‡∂≠‡∑ä‡∂≠‡∑î ‡∑Ä‡∑ô‡∂±‡∑ä‡∂±‡∑ö ‡∂ö‡∑ú‡∑Ñ‡∑ô‡∂Ø?",
                ongoing: "‡∂Ø‡∑ê‡∂±‡∂ß ‡∂ö‡∑ä‚Äç‡∂ª‡∑í‡∂∫‡∑è‡∂≠‡∑ä‡∂∏‡∂ö ‡∑É‡∑ö‡∑Ä‡∑è‡∑Ä‡∂±‡∑ä",
                no_ongoing: "‡∂ö‡∑ä‚Äç‡∂ª‡∑í‡∂∫‡∑è‡∂≠‡∑ä‡∂∏‡∂ö ‡∑É‡∑ö‡∑Ä‡∑è‡∑Ä‡∂±‡∑ä ‡∂ö‡∑í‡∑É‡∑í‡∑Ä‡∂ö‡∑ä ‡∂±‡∑ê‡∂≠",
                start_new: "‡∂±‡∑Ä ‡∂ú‡∂∏‡∂±‡∂ö‡∑ä ‡∑Ñ‡∑ù ‡∂©‡∑í‡∂Ω‡∑í‡∑Ä‡∂ª‡∑í ‡∂ë‡∂ö‡∂ö‡∑ä ‡∂Ö‡∂ª‡∂π‡∂±‡∑ä‡∂±",
                ride: "‡∂ª‡∂∫‡∑í‡∂©‡∑ä",
                flash: "‡∑Ü‡∑ä‡∂Ω‡∑ë‡∑Ç‡∑ä",
                food: "‡∂Ü‡∑Ñ‡∑è‡∂ª",
                help_emergency: "‡∂ã‡∂Ø‡∑Ä‡∑ä ‡∑É‡∑Ñ<br>‡∑Ñ‡∂Ø‡∑í‡∑É‡∑í ‡∂Ö‡∑Ä‡∑É‡∑ä‡∂Æ‡∑è",
                activities: "‡∂ú‡∂∏‡∂±‡∑ä ‡∑Ä‡∑í‡∑É‡∑ä‡∂≠‡∂ª",
                promotions: "‡∑Ä‡∑í‡∑Å‡∑ö‡∑Ç ‡∑Ä‡∑è‡∑É‡∑í",
                profile: "‡∂¥‡∑ê‡∂≠‡∑í‡∂ö‡∂©",
                sign_out: "‡∂â‡∑Ä‡∂≠‡∑ä ‡∑Ä‡∂±‡∑ä‡∂±",
                delete_signout: "‡∂ú‡∑í‡∂´‡∑î‡∂∏ ‡∂∏‡∂ö‡∑è ‡∂â‡∑Ä‡∂≠‡∑ä ‡∑Ä‡∂±‡∑ä‡∂±",
                delete_account: "‡∂ú‡∑í‡∂´‡∑î‡∂∏ ‡∂∏‡∂ö‡∂±‡∑ä‡∂±‡∂Ø?",
                delete_warning: "‡∂∏‡∑ô‡∂∏‡∂ú‡∑í‡∂±‡∑ä ‡∂î‡∂∂‡∂ú‡∑ö ‡∂ú‡∑í‡∂´‡∑î‡∂∏ ‡∑É‡∑Ñ ‡∂Ø‡∂≠‡∑ä‡∂≠ ‡∑É‡∑ä‡∂Æ‡∑í‡∂ª‡∑Ä‡∂∏ ‡∂∏‡∑ê‡∂ö‡∑ì ‡∂∫‡∂±‡∑î ‡∂á‡∂≠. ‡∂∏‡∑ô‡∂∫ ‡∂Ü‡∂¥‡∑É‡∑î ‡∑Ñ‡∑ê‡∂ª‡∑Ä‡∑í‡∂∫ ‡∂±‡∑ú‡∑Ñ‡∑ê‡∂ö.",
                confirm_delete: "‡∑É‡∑ä‡∂Æ‡∑í‡∂ª ‡∂ö‡∂ª‡∂±‡∑ä‡∂±",
                cancel: "‡∂Ö‡∑Ä‡∂Ω‡∂Ç‡∂ú‡∑î ‡∂ö‡∂ª‡∂±‡∑ä‡∂±",
                promo_link: "‡∂¥‡∑ä‚Äç‡∂ª‡∑Ä‡∂ª‡∑ä‡∂∞‡∂± ‡∑É‡∂∂‡∑ê‡∂≥‡∑í‡∂∫",
                open_browser: "‡∂∂‡∑ä‚Äç‡∂ª‡∑Ä‡∑î‡∑É‡∂ª‡∂∫‡∑ö ‡∑Ä‡∑í‡∑Ä‡∑ò‡∂≠ ‡∂ö‡∂ª‡∂±‡∑ä‡∂±",
                cant_display: "‡∂∏‡∑ô‡∂∏ ‡∑Ä‡∑ô‡∂∂‡∑ä ‡∂Ö‡∂©‡∑Ä‡∑í‡∂∫ ‡∂¥‡∑ô‡∂±‡∑ä‡∑Ä‡∑í‡∂∫ ‡∂±‡∑ú‡∑Ñ‡∑ê‡∂ö.",
                open_external: "‡∑Ä‡∑ô‡∂±‡∂≠‡∑ä ‡∂Ü‡∂ö‡∑è‡∂ª‡∂∫‡∂ö‡∑í‡∂±‡∑ä ‡∑Ä‡∑í‡∑Ä‡∑ò‡∂≠ ‡∂ö‡∂ª‡∂±‡∑ä‡∂±",
                loading_promo: "‡∂¥‡∑ä‚Äç‡∂ª‡∑Ä‡∂ª‡∑ä‡∂∞‡∂± ‡∑Ä‡∑ê‡∂©‡∑É‡∂ß‡∑Ñ‡∂±‡∑ä ‡∂¥‡∑ñ‡∂ª‡∂´‡∂∫ ‡∑Ä‡∑ô‡∂∏‡∑í‡∂±‡∑ä...",
                no_promos: "‡∂Ø‡∑ê‡∂±‡∂ß ‡∑Ä‡∑í‡∑Å‡∑ö‡∑Ç ‡∑Ä‡∑è‡∑É‡∑í ‡∂±‡∑ú‡∂∏‡∑ê‡∂≠",
                promo_link_hint: "‡∂Ω‡∑í‡∂±‡∑ä‡∂ö‡∑ä ‡∂ë‡∂ö ‡∑Ä‡∑í‡∑Ä‡∑ò‡∂≠ ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∂ß ‡∂î‡∂∂‡∂±‡∑ä‡∂±"
            },
            ta: {
                greeting_hello: "‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç, ",
                greeting_sub1: "‡Æµ‡ØÜ‡Æ≥‡Æø‡ÆØ‡Øá ‡Æö‡ØÜ‡Æ≤‡Øç‡Æ≤ ‡Æá‡Æ§‡ØÅ ‡Æí‡Æ∞‡ØÅ ‡Æá‡Æ©‡Æø‡ÆØ ‡Æ®‡Ææ‡Æ≥‡Øç!",
                greeting_sub2: "‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡ÆÖ‡Æü‡ØÅ‡Æ§‡Øç‡Æ§ ‡Æ™‡ÆØ‡Æ£‡Æ§‡Øç‡Æ§‡Æø‡Æ±‡Øç‡Æï‡ØÅ ‡Æ§‡ÆØ‡Ææ‡Æ∞‡Ææ?",
                greeting_sub3: "‡Æá‡Æ©‡Øç‡Æ±‡ØÅ ‡Æé‡Æô‡Øç‡Æï‡Øá ‡Æö‡ØÜ‡Æ≤‡Øç‡Æï‡Æø‡Æ±‡Øã‡ÆÆ‡Øç?",
                search_ph: "‡Æ®‡ØÄ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æé‡Æô‡Øç‡Æï‡ØÅ ‡Æö‡ØÜ‡Æ≤‡Øç‡Æ≤ ‡Æµ‡Æø‡Æ∞‡ØÅ‡ÆÆ‡Øç‡Æ™‡ØÅ‡Æï‡Æø‡Æ±‡ØÄ‡Æ∞‡Øç‡Æï‡Æ≥‡Øç?",
                ongoing: "‡Æ§‡Æ±‡Øç‡Æ™‡Øã‡Æ§‡Øà‡ÆØ ‡Æö‡ØÜ‡ÆØ‡Æ≤‡Øç‡Æ™‡Ææ‡Æü‡ØÅ‡Æï‡Æ≥‡Øç",
                no_ongoing: "‡Æö‡ØÜ‡ÆØ‡Æ≤‡Øç‡Æ™‡Ææ‡Æü‡ØÅ‡Æï‡Æ≥‡Øç ‡Æé‡Æ§‡ØÅ‡Æµ‡ØÅ‡ÆÆ‡Øç ‡Æá‡Æ≤‡Øç‡Æ≤‡Øà",
                start_new: "‡Æ™‡ØÅ‡Æ§‡Æø‡ÆØ ‡Æö‡Æµ‡Ææ‡Æ∞‡Æø ‡ÆÖ‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ ‡Æü‡ØÜ‡Æ≤‡Æø‡Æµ‡Æ∞‡Æø‡ÆØ‡Øà‡Æ§‡Øç ‡Æ§‡Øä‡Æü‡Æô‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç",
                ride: "‡Æö‡Æµ‡Ææ‡Æ∞‡Æø",
                flash: "‡ÆÉ‡Æ™‡Æø‡Æ≥‡Ææ‡Æ∑‡Øç",
                food: "‡Æâ‡Æ£‡Æµ‡ØÅ",
                help_emergency: "‡Æâ‡Æ§‡Æµ‡Æø ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç<br>‡ÆÖ‡Æµ‡Æö‡Æ∞‡Æ®‡Æø‡Æ≤‡Øà",
                activities: "‡Æö‡ØÜ‡ÆØ‡Æ≤‡Øç‡Æ™‡Ææ‡Æü‡ØÅ‡Æï‡Æ≥‡Øç",
                promotions: "‡Æö‡Æ≤‡ØÅ‡Æï‡Øà‡Æï‡Æ≥‡Øç",
                profile: "‡Æö‡ØÅ‡ÆØ‡Æµ‡Æø‡Æµ‡Æ∞‡ÆÆ‡Øç",
                sign_out: "‡Æµ‡ØÜ‡Æ≥‡Æø‡ÆØ‡Øá‡Æ±‡ØÅ",
                delete_signout: "‡Æï‡Æ£‡Æï‡Øç‡Æï‡Øà ‡Æ®‡ØÄ‡Æï‡Øç‡Æï‡Æø ‡Æµ‡ØÜ‡Æ≥‡Æø‡ÆØ‡Øá‡Æ±‡ØÅ",
                delete_account: "‡Æï‡Æ£‡Æï‡Øç‡Æï‡Øà ‡Æ®‡ØÄ‡Æï‡Øç‡Æï‡Æµ‡Ææ?",
                delete_warning: "‡Æá‡Æ§‡ØÅ ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æï‡Æ£‡Æï‡Øç‡Æï‡Øà‡ÆØ‡ØÅ‡ÆÆ‡Øç ‡Æ§‡Æ∞‡Æµ‡Øà‡ÆØ‡ØÅ‡ÆÆ‡Øç ‡Æ®‡Æø‡Æ∞‡Æ®‡Øç‡Æ§‡Æ∞‡ÆÆ‡Ææ‡Æï ‡Æ®‡ØÄ‡Æï‡Øç‡Æï‡ØÅ‡ÆÆ‡Øç. ‡Æá‡Æö‡Øç‡Æö‡ØÜ‡ÆØ‡Æ≤‡Øà ‡ÆÆ‡Ææ‡Æ±‡Øç‡Æ±‡Æø‡ÆØ‡ÆÆ‡Øà‡Æï‡Øç‡Æï ‡ÆÆ‡ØÅ‡Æü‡Æø‡ÆØ‡Ææ‡Æ§‡ØÅ.",
                confirm_delete: "‡Æâ‡Æ±‡ØÅ‡Æ§‡Æø‡Æ™‡Øç‡Æ™‡Æü‡ØÅ‡Æ§‡Øç‡Æ§‡Æµ‡ØÅ‡ÆÆ‡Øç",
                cancel: "‡Æ∞‡Æ§‡Øç‡Æ§‡ØÅ‡Æö‡ØÜ‡ÆØ‡Øç",
                promo_link: "‡Æö‡Æ≤‡ØÅ‡Æï‡Øà ‡Æá‡Æ£‡Øà‡Æ™‡Øç‡Æ™‡ØÅ",
                open_browser: "‡Æâ‡Æ≤‡Ææ‡Æµ‡Æø‡ÆØ‡Æø‡Æ≤‡Øç ‡Æ§‡Æø‡Æ±‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç",
                cant_display: "‡Æ§‡Æ≥‡Æ§‡Øç‡Æ§‡Øà ‡Æö‡ØÜ‡ÆØ‡Æ≤‡Æø‡ÆØ‡Æø‡Æ≤‡Øç ‡Æï‡Ææ‡Æü‡Øç‡Æü ‡ÆÆ‡ØÅ‡Æü‡Æø‡ÆØ‡Æµ‡Æø‡Æ≤‡Øç‡Æ≤‡Øà.",
                open_external: "‡Æµ‡ØÜ‡Æ≥‡Æø‡ÆØ‡Øá ‡Æ§‡Æø‡Æ±‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç",
                loading_promo: "‡Æö‡Æ≤‡ØÅ‡Æï‡Øà‡Æï‡Æ≥‡Øç ‡Æè‡Æ±‡Øç‡Æ±‡Æ™‡Øç‡Æ™‡Æü‡ØÅ‡Æï‡Æø‡Æ©‡Øç‡Æ±‡Æ©...",
                no_promos: "‡Æö‡ØÜ‡ÆØ‡Æ≤‡Æø‡Æ≤‡Øç ‡Æâ‡Æ≥‡Øç‡Æ≥ ‡Æö‡Æ≤‡ØÅ‡Æï‡Øà‡Æï‡Æ≥‡Øç ‡Æá‡Æ≤‡Øç‡Æ≤‡Øà",
                promo_link_hint: "‡Æá‡Æ£‡Øà‡Æ™‡Øç‡Æ™‡Øà‡Æ§‡Øç ‡Æ§‡Æø‡Æ±‡Æï‡Øç‡Æï‡Æ§‡Øç ‡Æ§‡Æü‡Øç‡Æü‡Æµ‡ØÅ‡ÆÆ‡Øç"
            }
        };

        window.updateGreeting = function() {
            const greetingKey = `greeting_sub${Math.floor(Math.random() * 3) + 1}`;
            const greetingText = translations[currentLang][greetingKey];
            document.getElementById('user-greeting-name').innerText = translations[currentLang]['greeting_hello'] + firstName;
            document.getElementById('random-greeting-text').innerText = greetingText;
            
            // Update Lang Button Text
            const langLabel = currentLang === 'en' ? 'EN' : (currentLang === 'si' ? '‡∑É‡∑í‡∂Ç' : '‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç');
            document.getElementById('lang-toggle-btn').innerText = langLabel;
        };

        window.toggleLanguage = function() {
            // Cycle: EN -> SI -> TA -> EN
            if (currentLang === 'en') currentLang = 'si';
            else if (currentLang === 'si') currentLang = 'ta';
            else currentLang = 'en';
            
            localStorage.setItem('speedo_lang', currentLang);
            applyLanguage();
            updateGreeting();
        };

        window.applyLanguage = function() {
            const elements = document.querySelectorAll('[data-i18n]');
            elements.forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (translations[currentLang][key]) {
                    el.innerHTML = translations[currentLang][key];
                }
            });

            const placeholders = document.querySelectorAll('[data-i18n-placeholder]');
            placeholders.forEach(el => {
                const key = el.getAttribute('data-i18n-placeholder');
                if (translations[currentLang][key]) {
                    el.placeholder = translations[currentLang][key];
                }
            });
        };

        /* --- NAVIGATION LOGIC --- */
        window.switchPage = function(pageId) {
            document.querySelectorAll('.content-area').forEach(p => p.classList.remove('active'));
            document.getElementById('page-' + pageId).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            const index = ['home','activities','promotions','profile'].indexOf(pageId);
            if(index >= 0) document.querySelectorAll('.nav-item')[index].classList.add('active');
        };

        window.showToast = function(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 3000);
        };

        /* --- SEARCH LOGIC --- */
        window.handleSearch = function() {
            const dest = document.getElementById('destination-input').value.trim();
            if (dest) {
                window.location.href = `ride.html?dest=${encodeURIComponent(dest)}`;
            } else {
                window.location.href = 'ride.html';
            }
        };

        window.addEventListener('load', async () => {
            // Initial Language Apply
            applyLanguage();

            const uid = localStorage.getItem('speedo_uid');
            if (!uid) { window.location.href = 'index.html'; return; }
            currentUser = uid;

            // Load Name
            let userName = "User";
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('speedo_user_')) {
                    const u = JSON.parse(localStorage.getItem(key));
                    if (u.uid === uid) { 
                        userName = u.name; 
                        break; 
                    }
                }
            }
            
            firstName = userName.split(' ')[0];
            
            // Profile Section
            document.getElementById('profile-name').innerText = userName;
            document.getElementById('profile-uid').innerText = "ID: " + uid.replace('user_', '');

            updateGreeting();

            try {
                await Promise.all([loadTopAds(), loadBottomAds(), initWeather(), loadPromotions()]);
                document.getElementById('skeleton-view').classList.add('hidden');
                document.getElementById('page-home').classList.add('active');
            } catch (error) {
                console.error("Loading error:", error);
                showToast("Error loading content");
            }
        });

        async function loadTopAds() {
            try {
                const snap = await get(ref(db, 'bannerad/top'));
                const container = document.getElementById('ad-carousel-top');
                container.innerHTML = '<div class="ad-badge">Ad</div>';
                if (snap.exists()) {
                    const data = Object.values(snap.val());
                    data.forEach((ad, idx) => {
                        const slide = document.createElement('div');
                        slide.className = `ad-slide ${idx===0?'active':''}`;
                        slide.innerHTML = `<img src="${ad.base64}">`;
                        container.appendChild(slide);
                    });
                } else container.innerHTML += `<div class="ad-slide active"><img src="https://picsum.photos/seed/adtop/800/225"></div>`;
            } catch(e) {}
        }

        async function loadBottomAds() {
            try {
                const snap = await get(ref(db, 'bannerad'));
                const container = document.getElementById('ad-banner-bottom');
                if (snap.exists()) {
                    const data = Object.values(snap.val());
                    if(data.length > 0) {
                        const randomAd = data[Math.floor(Math.random() * data.length)];
                        container.innerHTML = `<img src="${randomAd.base64}">`;
                    }
                } else container.innerHTML = `<img src="https://picsum.photos/seed/adbott/800/250">`;
            } catch(e) {}
        }

        async function loadPromotions() {
            const container = document.getElementById('promotions-container');
            try {
                const snap = await get(ref(db, 'promotions'));
                if(snap.exists()) {
                    container.innerHTML = '';
                    const promos = Object.values(snap.val());
                    promos.forEach(p => {
                        const card = document.createElement('div');
                        card.className = 'promo-card';
                        
                        const hintHtml = p.link ? `<div class="promo-link-hint"><span class="material-icons" style="font-size:12px;">link</span> ${translations[currentLang]['promo_link_hint']}</div>` : '';
                        
                        card.onclick = () => { if(p.link) openLinkModal(p.link); };

                        card.innerHTML = `
                            <div class="promo-img-container">
                                <img src="${p.base64}" alt="Promo">
                            </div>
                            <div class="promo-details">
                                <div class="promo-title">${p.title}</div>
                                ${hintHtml}
                            </div>
                        `;
                        container.appendChild(card);
                    });
                } else {
                    container.innerHTML = `<div class="activity-box">${translations[currentLang]['no_promos']}</div>`;
                }
            } catch(e) {
                container.innerHTML = '<div class="activity-box">Error loading promotions</div>';
            }
        }

        /* --- LINK MODAL LOGIC --- */
        window.openLinkModal = function(url) {
            const modal = document.getElementById('link-modal');
            const iframe = document.getElementById('promo-iframe');
            const fallback = document.getElementById('iframe-fallback');
            const extBtn = document.getElementById('external-link-btn');
            const fallbackBtn = document.getElementById('fallback-link-btn');

            extBtn.href = url;
            fallbackBtn.href = url;
            extBtn.style.display = 'block';

            modal.style.display = 'flex';
            iframe.style.display = 'block';
            fallback.style.display = 'none';
            iframe.src = url;

            iframe.onerror = () => { 
                iframe.style.display = 'none'; fallback.style.display = 'block'; 
            };
        };

        window.closeLinkModal = function() {
            const modal = document.getElementById('link-modal');
            const iframe = document.getElementById('promo-iframe');
            modal.style.display = 'none';
            iframe.src = 'about:blank';
        };

        async function initWeather() {
            if(navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(async (pos) => {
                    try {
                        const lat = pos.coords.latitude, lon = pos.coords.longitude;
                        const geo = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`).then(r => r.json());
                        const dist = geo.address.city_district || geo.address.town || "Unknown";
                        const w = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`).then(r => r.json());
                        document.getElementById('weather-temp').innerText = `${Math.round(w.current_weather.temperature)}¬∞C`;
                        document.getElementById('weather-district').innerText = dist;
                        const codes = {0:'‚òÄÔ∏è',1:'üå§Ô∏è',2:'‚õÖ',3:'‚òÅÔ∏è',45:'üå´Ô∏è',61:'üåßÔ∏è',80:'üå¶Ô∏è',95:'‚õàÔ∏è'};
                        document.getElementById('weather-emoji').innerText = codes[w.current_weather.weathercode] || 'üå°Ô∏è';
                    } catch(e) {}
                });
            }
        }

        /* --- SIGN OUT DROPDOWN LOGIC --- */
        window.toggleSignOutMenu = function(e) {
            e.stopPropagation();
            const dd = document.getElementById('signout-dropdown');
            if (dd.classList.contains('open')) {
                dd.classList.remove('open');
            } else {
                dd.classList.add('open');
            }
        };

        document.addEventListener('click', function(e) {
            const dd = document.getElementById('signout-dropdown');
            const btn = document.querySelector('.sign-out-btn');
            if (!dd.contains(e.target) && !btn.contains(e.target)) {
                dd.classList.remove('open');
            }
        });

        window.handleSignOut = function() {
            localStorage.clear();
            window.location.href = 'index.html';
        };

        window.showDeleteConfirm = function() {
            document.getElementById('signout-dropdown').classList.remove('open');
            document.getElementById('delete-modal').style.display = 'flex';
        };

        window.closeDeleteModal = function() {
            document.getElementById('delete-modal').style.display = 'none';
        };

        window.handleDeleteAccount = async function() {
            if(!currentUser) return;
            try {
                await remove(ref(db, 'users/' + currentUser));
                localStorage.clear();
                showToast(translations[currentLang]['confirm_delete']);
                setTimeout(() => window.location.href = 'index.html', 1000);
            } catch(e) {
                showToast("Error deleting account");
            }
        };
    </script>
</body>
</html>
